



# MindFlow V5: Technical Architecture


## 1. System Stack



* **Frontend:** Flutter (iOS/Android) for 60fps "Tactile" UI.
* **State Management:** Riverpod (Providers) for reactive ML analytics.
* **Backend/DB:** Firebase (Firestore + Auth).
* **Intelligence:** Google Gemini 2.5 Flash (API via generateContent).
* **Payments:** RevenueCat SDK (Cloud-to-Cloud sync).


## 2. File Structure (Feature-First Clean Architecture)

lib/ \
├── core/ \
│   ├── theme/        # JobsTheme (Colors, Type, Physics) \
│   ├── utils/        # ObserverMiddleware (Latency/Backspace tracking) \
│   └── services/     # RevenueCatService (Monetization) \
├── features/ \
│   ├── chat/         # Invisible Architect Engine & UI \
│   ├── onboarding/   # 5-in-1 Multidimensional Quiz \
│   ├── retention/    # FlowStreakRing & Habit Logic \
│   └── insights/     # StakeholderDashboard (ML Stats) \
└── main.dart         # Entry point & ProviderScope \



## 3. Data Flow: The "Invisible Architect" Protocol



1. **Input:** BehavioralObserver captures latency and backspaces while user types.
2. **Request:** AdvancedCoachService sends User Text + History + System Prompt to Gemini.
3. **Processing:** Gemini executes NLP Intervention based on TRAINING_CRITERIA.md.
4. **Output:** Gemini returns a **Split Payload**:
    * Part A (Text): Hypnotic Wisdom (shown to user).
    * Part B (JSON): Psychometric telemetry (saved to Firestore).
5. **Persistence:** Firestore stores JSON under /artifacts/{appId}/users/{uid}/v5_analytics.


## 4. Scalability & Monetization Logic



* **RevenueCat:** A PremiumProvider wraps the app. If isPremium == false, certain AI interventions are gated via the AdvancedCoachService.
* **Firestore:** Strict pathing ensures each user’s "Soul" (Profile) is private and SOC2-ready.